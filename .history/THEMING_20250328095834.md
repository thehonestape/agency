# Workhorse Agency Theming Architecture

This document outlines our theming architecture and provides guidelines to maintain consistency. **READ THIS BEFORE MODIFYING ANY THEME-RELATED CODE.**

## Core Architecture

Our theming system follows these principles:

1. **Single Source of Truth**: All theme variables are defined in `@theme` in `theme.css`
2. **One Method for Dark Mode**: We use the `.dark` class for dark mode, not media queries inside theme blocks
3. **CSS Variables + Tailwind v4 Integration**: CSS variables are leveraged by Tailwind v4's CSS-first approach
4. **Consistent Color Format**: We use hex colors for our theme system, with built-in color scale generation

## Tailwind CSS v4 Configuration

We use Tailwind CSS v4 with its CSS-first approach, which differs significantly from v3:

### Key Changes in v4

1. **No tailwind.config.js/mjs File**: Configuration is directly in CSS files
2. **CSS-First Configuration**: All theme configuration is in CSS using `@theme`, `@utilities`, etc.
3. **Automatic Source Detection**: Content sources are automatically detected, reducing configuration
4. **Built-in Import Support**: CSS imports are handled natively without separate plugins
5. **PostCSS Plugin is Separate**: The PostCSS plugin lives in a dedicated `@tailwindcss/postcss` package
6. **Vite Integration**: We use the dedicated `@tailwindcss/vite` plugin instead of PostCSS in our Vite setup

### Critical Rules for Theme Files

1. **`@theme` Block Limitations**: 
   - `@theme` blocks can ONLY contain custom properties or `@keyframes`
   - NEVER add media queries, selectors, or other rules inside `@theme` blocks
   - All dark mode styles must be implemented using `.dark` class selectors OUTSIDE the `@theme` block

2. **Custom Utility Classes**:
   - Custom utilities for theme variables are defined in an `@utilities` block in `globals.css`
   - This is required for any custom utility name (e.g., `bg-background`)

3. **PostCSS Configuration**:
   - Our `postcss.config.mjs` uses ES module format and only includes `@tailwindcss/postcss`
   - Do not add back `autoprefixer` or `postcss-import` - Tailwind v4 handles these internally

### Example Configuration

```css
/* In theme.css - CORRECT */
@theme {
  --color-primary: #3b82f6;
  --color-secondary: #10b981;
}

/* Dark mode OUTSIDE @theme block */
.dark {
  --color-primary: #60a5fa;
  --color-secondary: #34d399;
}

/* In globals.css - CORRECT */
@import "./theme.css";
@import "tailwindcss";

/* Define utilities for theme variables */
@utilities {
  .bg-background {
    background-color: var(--background);
  }
  .text-foreground {
    color: var(--foreground);
  }
}
```

### Incorrect Configurations to Avoid

```css
/* INCORRECT - media query inside @theme block */
@theme {
  @media (prefers-color-scheme: dark) {
    --color-primary: #60a5fa;
  }
}

/* INCORRECT - using @apply with custom utilities without @utilities block */
.my-component {
  @apply bg-background text-foreground;
}
```

## Common Issues and Solutions

### Issue: Unknown utility class warning

```
Cannot apply unknown utility class: bg-background
```

**Solution**: Add an `@utilities` block in `globals.css` to define custom utility classes:

```css
@utilities {
  .bg-background {
    background-color: var(--background);
  }
}
```

### Issue: @theme blocks with disallowed content

```
@theme blocks must only contain custom properties or @keyframes
```

**Solution**: Move all selectors and media queries outside the `@theme` block:

```css
/* BEFORE - Incorrect */
@theme {
  @media (prefers-color-scheme: dark) {
    --color-primary: #60a5fa;
  }
}

/* AFTER - Correct */
@theme {
  --color-primary: #3b82f6;
  --color-primary-dark: #60a5fa;
}

.dark {
  --color-primary: var(--color-primary-dark);
}
```

### Issue: Port already in use

If you encounter a "Port 3002 is already in use" error:

**Solution**: Kill any processes using the port with:

```bash
lsof -ti:3002 | xargs kill -9
```

Then restart the development server.

## Theme System Implementation

Our project uses a custom theme system with React integration:

1. **Hex-based Color System**: All colors are defined in hex format (e.g., '#3b82f6')
2. **Automatic Color Scales**: The system generates color scales (50-950) from base colors
3. **CSS Variables**: Theme values are automatically converted to CSS variables
4. **React Integration**: Built-in hooks and context for theme management

### Key Files

- **`src/lib/theme/types.ts`**: TypeScript interfaces for theme configuration
- **`src/lib/theme/generator.ts`**: Theme generation and CSS variable creation
- **`src/lib/theme/useTheme.ts`**: React hook for theme management
- **`src/lib/theme/ThemeProvider.tsx`**: React context provider
- **`src/styles/theme.css`**: Contains theme variables with `@theme` directive
- **`src/styles/globals.css`**: Imports theme.css and tailwindcss, defines custom utilities

## Usage

### Basic Setup

Wrap your app with the `ThemeProvider`:

```tsx
import { ThemeProvider } from '@/lib/theme/ThemeProvider';

function App() {
  return (
    <ThemeProvider>
      <YourApp />
    </ThemeProvider>
  );
}
```

### Using the Theme Hook

Use the `useThemeContext` hook to access and modify the theme:

```tsx
import { useThemeContext } from '@/lib/theme/ThemeProvider';

function ThemeControls() {
  const {
    theme,
    setMode,
    setPrimaryColor,
    setSecondaryColor,
    setAccentColor,
  } = useThemeContext();

  return (
    <div>
      <button onClick={() => setMode('dark')}>Dark Mode</button>
      <button onClick={() => setMode('light')}>Light Mode</button>
      <input
        type="color"
        value={theme.colors.primary}
        onChange={(e) => setPrimaryColor(e.target.value)}
      />
    </div>
  );
}
```

### Using Theme Variables in CSS

The theme system generates CSS variables that you can use in your styles:

```css
.my-component {
  background-color: var(--color-background);
  color: var(--color-foreground);
  padding: var(--spacing-md);
  border-radius: var(--radius-md);
  font-family: var(--font-sans);
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
}
```

## Theme Configuration

The theme system accepts the following configuration options:

```typescript
interface ThemeConfig {
  primaryColor: string;      // Hex color (e.g., '#3b82f6')
  secondaryColor?: string;   // Optional secondary color
  accentColor?: string;      // Optional accent color
  mode?: 'light' | 'dark';   // Theme mode
  fontFamily?: {            // Custom font families
    sans?: string;
    mono?: string;
  };
  baseSpacing?: number;     // Base spacing unit (default: 4)
  baseRadius?: number;      // Base border radius (default: 4)
}
```

## Available Theme Properties

### Colors

- Base colors: `primary`, `secondary`, `accent`
- UI colors: `background`, `foreground`, `card`, `card-foreground`, `muted`, `muted-foreground`, `border`, `input`
- State colors: `destructive`, `success`, `warning`, `info` (with their foreground variants)

### Typography

- Font families: `sans`, `mono`
- Font sizes: `xs`, `sm`, `base`, `lg`, `xl`, `2xl`, `3xl`, `4xl`, `5xl`
- Line heights: Corresponding to each font size

### Spacing

- `xxs`, `xs`, `sm`, `md`, `lg`, `xl`, `xxl`

### Border Radius

- `sm`, `md`, `lg`, `xl`, `full`

### Shadows

- `sm`, `md`, `lg`, `xl`

## DO's and DON'Ts

### ✅ DO:

- Use CSS variables for any color or theme property that might change between themes
- Use the theme hook for dynamic theme changes
- Use semantic color names (e.g., `primary` instead of specific colors)
- Test both light and dark mode when adding new UI components
- Use the theme system's built-in color scale generation
- Keep color values in hex format

### ❌ DON'T:

- Add new theme variables directly to components without using the theme system
- Mix different theme systems (e.g., data-theme attributes + class-based)
- Hardcode colors in components unless they're truly static
- Duplicate variable definitions in multiple places
- Add redundant CSS that Tailwind could handle
- Use HSL or other color formats - stick to hex

## Adding New Theme Colors

If you need to add a new semantic color:

1. Add it to the theme configuration in your component
2. The system will automatically generate CSS variables
3. Use it via CSS variables or Tailwind utility classes

Example:
```tsx
const { theme, updateConfig } = useThemeContext();

// Add new color
updateConfig({
  primaryColor: '#3b82f6',
  secondaryColor: '#10b981',
  accentColor: '#f59e0b'
});
```

```css
.my-component {
  background-color: var(--color-primary);
  color: var(--color-secondary);
}
```

## Modifying Existing Colors

When changing existing colors:

1. Use the theme hook's color setters
2. Test contrast ratios for accessibility
3. Consider both light and dark mode
4. Check existing components that might be using the color

## Before You Commit

- Check that you're not introducing redundant color declarations
- Ensure dark mode still works properly
- Verify that you haven't broken any existing components
- Run the app to check for any styling errors
- Test the theme system's color scale generation

---

**Remember**: This architecture was carefully streamlined to be maintainable and efficient. If you believe a change to the architecture itself is needed, discuss with the team first. 